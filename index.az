// Main Azalea Web Application
// Pure Azalea - uses native view system, no HTML rendering

// Global state
form map state from {}
form num user_level from 1
form num user_xp from 0
form num current_lesson from 0

// AI Help function using llm7.io
act ai_help question do
    form text url from "https://llm7.io/api/chat"
    form text prompt from "You are helping someone learn Azalea programming language. " plus question
    
    // Call llm7.io API
    call net post url with prompt put response
    
    if response same "" do
        give "I'm here to help! Try asking about Azalea syntax, concepts, or debugging your code."
    end
    give response
end

// Landing page
act landing_page req do
    call view header style background "linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
                     style color white
                     style padding 4rem 2rem
                     style text-align center do
        call view h1 style font-size 4rem
                     style margin-bottom 1rem do
            "ðŸŒº Azalea"
        end
        call view p style font-size 1.5rem
                     style opacity 0.9
                     style margin-bottom 2rem do
            "Elegant, minimal, powerful programming language"
        end
        call view div style display flex
                     style gap 1rem
                     style justify-content center do
            call view link "/playground" "Get Started"
            call view link "/lessons" "Learn"
        end
    end
    
    call view main style padding 4rem 2rem
                   style max-width 1200px
                   style margin 0 auto do
        call view section style margin-bottom 4rem do
            call view h2 style text-align center
                         style font-size 2.5rem
                         style margin-bottom 3rem do
                "Why Azalea?"
            end
            call view div style display grid
                         style grid-template-columns "repeat(3, 1fr)"
                         style gap 2rem do
                call view card style padding 2rem
                               style border-radius 12px
                               style box-shadow "0 4px 6px rgba(0,0,0,0.1)"
                               style text-align center do
                    call view h3 style color #667eea
                                 style margin-bottom 1rem do
                        "Easy to Learn"
                    end
                    call view p do
                        "Perfect for beginners. Kids can learn it! Simple syntax that reads naturally."
                    end
                end
                call view card style padding 2rem
                               style border-radius 12px
                               style box-shadow "0 4px 6px rgba(0,0,0,0.1)"
                               style text-align center do
                    call view h3 style color #667eea
                                 style margin-bottom 1rem do
                        "Powerful"
                    end
                    call view p do
                        "Build complex systems, web apps, backends, and more. Scales from simple to professional."
                    end
                end
                call view card style padding 2rem
                               style border-radius 12px
                               style box-shadow "0 4px 6px rgba(0,0,0,0.1)"
                               style text-align center do
                    call view h3 style color #667eea
                                 style margin-bottom 1rem do
                        "Beautiful UI"
                    end
                    call view p do
                        "Full CSS support. Create stunning interfaces with minimal code. Beautiful by default."
                    end
                end
            end
        end
        
        call view section style background #f5f5f5
                         style padding 3rem
                         style border-radius 12px do
            call view h2 style margin-bottom 2rem do
                "Try It Now"
            end
            call view pre style background #1e1e1e
                         style color #d4d4d4
                         style padding 1.5rem
                         style border-radius 8px
                         style font-family monospace do
                "say Hello World\nform num a from ten\nsay a"
            end
            call view link "/playground" "Run in Playground"
        end
    end
    
    call view footer style background #2d3748
                     style color white
                     style padding 2rem
                     style text-align center do
        call view p do
            "Made with Azalea - From beginner to professional"
        end
    end
end

// Playground page
act playground_page req do
    call view header style background #2d3748
                     style color white
                     style padding 1.5rem 2rem
                     style display flex
                     style justify-content space-between
                     style align-items center do
        call view h1 style margin 0 do
            "ðŸŽ® Playground"
        end
        call view div style display flex
                     style gap 1rem do
            call view link "/" "Landing"
            call view link "/lessons" "Lessons"
        end
    end
    
    call view main style display grid
                   style grid-template-columns "1fr 1fr"
                   style min-height calc(100vh - 80px)
                   style gap 0 do
        call view div style display flex
                     style flex-direction column
                     style border-right "1px solid #e0e0e0" do
            call view div style background #f5f5f5
                         style padding 1rem
                         style border-bottom "1px solid #e0e0e0" do
                call view text style font-weight bold do
                    "Code Editor"
                end
            end
            call view textarea id editor
                             style flex 1
                             style border none
                             style padding 1rem
                             style font-family monospace
                             style font-size 14px
                             style resize none
                             style outline none do
                "say Hello World\nform num a from ten\nsay a\nloop five do\n    say step\nend"
            end
            call view button "Run"
                         style background #667eea
                         style color white
                         style padding 0.5rem 1rem
                         style border-radius 6px
                         style margin 1rem do
                say "Running code..."
            end
        end
        
        call view div style display flex
                     style flex-direction column
                     style background #1e1e1e do
            call view div style background #2d3748
                         style color white
                         style padding 1rem
                         style border-bottom "1px solid #333" do
                call view text style font-weight bold do
                    "Output"
                end
            end
            call view div id output
                         style flex 1
                         style padding 1rem
                         style color #d4d4d4
                         style font-family monospace
                         style font-size 14px
                         style overflow-y auto
                         style white-space pre-wrap do
                "Ready to run code..."
            end
        end
    end
    
    // AI Help section
    call view div style background #f5f5f5
                     style padding 2rem
                     style border-top "1px solid #e0e0e0" do
        call view h3 style margin-bottom 1rem do
            "ðŸ¤– Need Help? Ask AI"
        end
        call view textarea id ai_question
                         placeholder "Ask a question about Azalea..."
                         style width 100%
                         style padding 1rem
                         style border-radius 8px
                         style border "1px solid #ccc"
                         style font-size 14px
                         style min-height 100px
                         style margin-bottom 1rem
        call view button "Get AI Help"
                     style background #667eea
                     style color white
                     style padding 0.75rem 1.5rem
                     style border-radius 6px do
            form text question from "How do I use loops in Azalea?"
            form text answer from call ai_help question
            say answer
        end
    end
end

// Lessons page
act lessons_page req do
    // Lesson data
    form list lesson_titles from ["Hello World", "Variables", "Math Operations", "Conditionals", "Loops", "Functions", "Lists", "UI Components", "Styling", "Forms", "Advanced Functions"]
    form list lesson_codes from [
        "say Hello World",
        "form num age from 10\nsay age",
        "form num a from 10\nform num b from 5\nsay a plus b",
        "form num age from 15\nif age over 10 do\n    say You are old enough\nend",
        "loop 5 do\n    say step\nend",
        "act greet name do\n    say Hello\n    say name\nend\n\ncall greet Alice",
        "form list names from [Alice, Bob, Charlie]\nloop names do\n    say step\nend",
        "call view button Click Me do\n    say Button clicked!\nend",
        "call view div style background blue style color white do\n    call view text Hello\nend",
        "call view input name placeholder Enter name\ncall view button Submit do\n    say Form submitted!\nend",
        "act calculate a b op do\n    if op same plus do\n        give a plus b\n    end\nend\n\ncall calculate 10 5 plus put result\nsay result"
    ]
    form list lesson_hints from [
        "Use the 'say' keyword to print text",
        "Use 'form' to create variables, 'num' for numbers",
        "Use 'plus', 'minus', 'times', 'div' for math",
        "Use 'if', 'over', 'under', 'same' for comparisons",
        "Use 'loop' with a number to repeat",
        "Use 'act' to define, 'call' to use functions",
        "Use 'list' type and loop over it",
        "Use 'view' to create UI components",
        "Use 'style' keyword to add CSS",
        "Use 'input' for text fields",
        "Functions can take multiple parameters"
    ]
    form list lesson_goals from [
        "Print 'Hello World'",
        "Create a variable and print it",
        "Add two numbers and print the result",
        "Check if age is over 10",
        "Count from 0 to 4",
        "Create a function that greets someone",
        "Create a list and print all items",
        "Create a button that prints when clicked",
        "Create a styled div",
        "Create an input and submit button",
        "Create a calculator function"
    ]
    
    form text lesson_title from lesson_titles[current_lesson]
    form text lesson_code from lesson_codes[current_lesson]
    form text lesson_hint from lesson_hints[current_lesson]
    form text lesson_goal from lesson_goals[current_lesson]
    
    call view header style background "linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
                     style color white
                     style padding 1.5rem 2rem do
        call view div style display flex
                     style justify-content space-between
                     style align-items center do
            call view div do
                call view h1 style margin 0
                             style margin-bottom 0.5rem do
                    "ðŸ“š Learn Azalea"
                end
                call view div style display flex
                             style gap 2rem
                             style align-items center do
                    call view text style opacity 0.9 do
                        "Level:"
                    end
                    call view text style font-size 1.5rem
                                 style font-weight bold do
                        user_level
                    end
                    call view text style opacity 0.9 do
                        "XP:"
                    end
                    call view text style font-size 1.5rem
                                 style font-weight bold do
                        user_xp
                    end
                end
            end
            call view div style display flex
                         style gap 1rem do
                call view link "/" "Landing"
                call view link "/playground" "Playground"
            end
        end
    end
    
    call view main style display grid
                   style grid-template-columns "300px 1fr"
                   style min-height calc(100vh - 120px)
                   style gap 0 do
        call view div style background #f5f5f5
                     style border-right "1px solid #e0e0e0"
                     style overflow-y auto
                     style padding 1rem do
            call view h3 style margin-bottom 1rem do
                "Lessons"
            end
            loop 11 do
                form num lesson_id from step
                form text lesson_name from lesson_titles[lesson_id]
                form bool is_current from lesson_id same current_lesson
                
                call view div style padding 0.75rem
                             style margin-bottom 0.5rem
                             style border-radius 6px
                             style cursor pointer
                             style background if is_current then #667eea else transparent
                             style color if is_current then white else #333 do
                    call view text do
                        lesson_id
                        ". "
                        lesson_name
                    end
                end
            end
        end
        
        call view div style display flex
                     style flex-direction column
                     style padding 2rem
                     style overflow-y auto do
            call view h2 style font-size 2rem
                         style margin-bottom 1rem
                         style color #667eea do
                lesson_title
            end
            call view div style background #e3f2fd
                         style padding 1rem
                         style border-radius 8px
                         style margin-bottom 1.5rem do
                call view text style font-weight bold
                             style margin-bottom 0.5rem do
                    "Goal:"
                end
                call view text do
                    lesson_goal
                end
            end
            call view p style line-height 1.6
                         style margin-bottom 2rem do
                "Learn by example. Try the code below in the playground!"
            end
            call view pre style background #1e1e1e
                         style color #d4d4d4
                         style padding 1.5rem
                         style border-radius 8px
                         style margin-bottom 1.5rem
                         style font-family monospace
                         style white-space pre-wrap do
                lesson_code
            end
            call view div style background #fff3cd
                         style padding 1rem
                         style border-radius 8px
                         style margin-bottom 2rem do
                call view text style font-weight bold do
                    "ðŸ’¡ Hint:"
                end
                call view text do
                    lesson_hint
                end
            end
            call view div style display flex
                         style gap 1rem do
                call view link "/playground" "Try in Playground"
                call view button "Mark Complete"
                             style background #28a745
                             style color white
                             style padding 1rem 2rem
                             style border-radius 8px
                             style font-weight bold do
                    user_xp give user_xp plus 50
                    say "Lesson completed! +50 XP"
                end
            end
            
            // AI Help
            call view div style background #f5f5f5
                         style padding 1.5rem
                         style border-radius 8px
                         style margin-top 2rem do
                call view h3 style margin-bottom 1rem do
                    "ðŸ¤– Need Help? Ask AI"
                end
                call view textarea id lesson_question
                                 placeholder "Ask about this lesson..."
                                 style width 100%
                                 style padding 1rem
                                 style border-radius 8px
                                 style border "1px solid #ccc"
                                 style font-size 14px
                                 style min-height 100px
                                 style margin-bottom 1rem
                call view button "Get AI Help"
                             style background #667eea
                             style color white
                             style padding 0.75rem 1.5rem
                             style border-radius 6px do
                    form text question from "Explain this lesson"
                    form text answer from call ai_help question
                    say answer
                end
            end
        end
    end
end

// Routes
call serve get "/" give landing_page
call serve get "/playground" give playground_page
call serve get "/lessons" give lessons_page

// Start server
call serve on 3000
say "Azalea web app running on port 3000"
